parameters:
  binary:   ''

steps:
  - task: DownloadBuildArtifacts@0
    inputs:
      artifactName: dc
      downloadPath: .

  - bash: chmod +x ./dc/${{ parameters.binary }}
    condition: eq(variables['Agent.OS'], 'Linux')

  - bash: |
      mkdir -p D && mv ./dc/${{ parameters.binary }} D/
      ./D/${{ parameters.binary }} -v
    displayName: Verify initial setup

  - bash: |
      dc -v use dmd-2.082.1
      dmd -run test/sample.d
    displayName: Verify switching compiler works (1)

  - bash: |
      dc -v use ldc-1.13.0
      ldmd2 -run test/sample.d
    displayName: Verify switching compiler works (2)
