parameters:
  binary:   ''

steps:
  - task: DownloadBuildArtifacts@0
    inputs:
      artifactName: dc
      downloadPath: .

  - bash: chmod +x ./dc/${{ parameters.binary }}
    condition: eq(variables['Agent.OS'], 'Linux')

  - bash: |
      mkdir -p D && mv ./dc/${{ parameters.binary }} D/
      ./D/${{ parameters.binary }} use dmd-2.082.1
      ./D/bin/dmd -run test/sample.d
    displayName: Verify switching compiler works (1)

  - bash: |
      ./D/bin/${{ parameters.binary }} use ldc-1.13.0
      ./D/bin/ldmd2 -run test/sample.d
    displayName: Verify switching compiler works (2)
