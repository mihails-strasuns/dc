parameters:
  url: ''
  bindir: ''
  archive: ''
  binary:   ''

steps:
  - task: VSBuild@1
    inputs:
      solution: lib7z/lib7z.sln
      platform: x64
      configuration: Release
    displayName: Build 7z SDK
    condition: eq(variables['Agent.OS'], 'Windows_NT')

  - powershell: wget -O ${{ parameters.archive }} ${{ parameters.url }}
    displayName: Download compiler package

  - task: ExtractFiles@1
    inputs:
      archiveFilePatterns: ${{ parameters.archive }}
      destinationFolder: 'ldc'

  - script: ci\windows.bat
    env:
      bindir: ${{ parameters.bindir }}
    displayName: Build application (Windows)
    condition: eq(variables['Agent.OS'], 'Windows_NT')

  - script: ci/linux.sh
    env:
      bindir: ${{ parameters.bindir }}
    displayName: Build application (Linux)
    condition: eq(variables['Agent.OS'], 'Linux')

  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: ${{ parameters.binary }}
      artifactName: dc

